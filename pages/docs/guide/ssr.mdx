---
id: ssr
title: SSR
---

## SSR

μ„λ²„ μ‚¬μ΄λ“ λ λ”λ§(SSR)μ€ μ„λ²„μ—μ„ μ»΄ν¬λ„νΈλ¥Ό λ λ”λ§ν•κ³  HTML λ§ν¬μ—…μ„ ν΄λΌμ΄μ–ΈνΈλ΅ μ „μ†΅ν•λ” κ³Όμ •μ…λ‹λ‹¤. κ·Έ ν›„ ν΄λΌμ΄μ–ΈνΈλ” ν•΄λ‹Ή λ§ν¬μ—…μ„ μ™„μ „ν• μƒνΈμ‘μ©μ΄ κ°€λ¥ν• μ»΄ν¬λ„νΈλ΅ ν•μ΄λ“λ μ΄νΈ(hydrate)ν•©λ‹λ‹¤.

λ³΄ν†µ κ³ λ ¤ν•΄μ•Ό ν•  λ‘ κ°€μ§€ μ ν•μ SSRμ΄ μμµλ‹λ‹¤:

- λΉ„μ¤νΈλ¦¬λ° SSR
  - μ „μ²΄ νμ΄μ§€κ°€ μ„λ²„μ—μ„ λ λ”λ§λμ–΄ ν΄λΌμ΄μ–ΈνΈλ΅ ν•λ‚μ HTML μ”μ²­μΌλ΅ μ „μ†΅λλ©°, μ• ν”λ¦¬μΌ€μ΄μ…μ΄ ν΄λΌμ΄μ–ΈνΈμ—μ„ ν•μ΄λ“λ μ΄νΈν•  μ μλ” μ§λ ¬ν™”λ λ°μ΄ν„°λ„ ν¬ν•¨λ©λ‹λ‹¤.
- μ¤νΈλ¦¬λ° SSR
  - νμ΄μ§€μ μ¤‘μ”ν• μ²« λ²μ§Έ νμΈνΈκ°€ μ„λ²„μ—μ„ λ λ”λ§λμ–΄ ν΄λΌμ΄μ–ΈνΈλ΅ ν•λ‚μ HTML μ”μ²­μΌλ΅ μ „μ†΅λλ©°, μ• ν”λ¦¬μΌ€μ΄μ…μ΄ ν΄λΌμ΄μ–ΈνΈμ—μ„ ν•μ΄λ“λ μ΄νΈν•  μ μλ” μ§λ ¬ν™”λ λ°μ΄ν„°λ„ ν¬ν•¨λ©λ‹λ‹¤.
  - κ·Έ ν›„ λ‚λ¨Έμ§€ νμ΄μ§€λ” μ„λ²„μ—μ„ λ λ”λ§λλ” λ€λ΅ ν΄λΌμ΄μ–ΈνΈλ΅ μ¤νΈλ¦¬λ°λ©λ‹λ‹¤.

μ΄ κ°€μ΄λ“λ” TanStack Routerλ΅ λ‘ κ°€μ§€ μ ν•μ SSRμ„ κµ¬ν„ν•λ” λ°©λ²•μ„ μ„¤λ…ν•©λ‹λ‹¤!

## Non-Streaming SSR

λΉ„μ¤νΈλ¦¬λ° μ„λ²„ μ‚¬μ΄λ“ λ λ”λ§μ€ μ„λ²„μ—μ„ μ• ν”λ¦¬μΌ€μ΄μ… νμ΄μ§€μ λ§ν¬μ—…μ„ λ λ”λ§ν•κ³  μ™„μ„±λ HTML λ§ν¬μ—…(λ° λ°μ΄ν„°)μ„ ν΄λΌμ΄μ–ΈνΈλ΅ μ „μ†΅ν•λ” κ³ μ „μ μΈ κ³Όμ •μ…λ‹λ‹¤. κ·Έλ° λ‹¤μ ν΄λΌμ΄μ–ΈνΈλ” λ§ν¬μ—…μ„ μ™„μ „ν• μƒνΈμ‘μ©μ΄ κ°€λ¥ν• μ• ν”λ¦¬μΌ€μ΄μ…μΌλ΅ λ‹¤μ‹ ν•μ΄λ“λ μ΄νΈν•©λ‹λ‹¤.

λΉ„μ¤νΈλ¦¬λ° SSRμ„ TanStack Routerλ΅ κµ¬ν„ν•λ ¤λ©΄ λ‹¤μκ³Ό κ°™μ€ μ ν‹Έλ¦¬ν‹°κ°€ ν•„μ”ν•©λ‹λ‹¤:

- `StartServer` from `@tanstack/start/server`
  - μ: `<StartServer router={router} />`
  - μ΄ μ»΄ν¬λ„νΈλ¥Ό μ„λ²„ μ—”νΈλ¦¬μ—μ„ λ λ”λ§ν•λ©΄ μ• ν”λ¦¬μΌ€μ΄μ…μ„ λ λ”λ§ν•κ³  μ• ν”λ¦¬μΌ€μ΄μ… μμ¤€μ—μ„ ν•μ΄λ“λ μ΄νΈ/λ””ν•μ΄λ“λ μ΄νΈλ¥Ό μλ™μΌλ΅ μ²λ¦¬ν•λ©° `Router`μ `Wrap` μ»΄ν¬λ„νΈ μµμ…μ„ κµ¬ν„ν•©λ‹λ‹¤.
- `StartClient` from `@tanstack/start`
  - μ: `<StartClient router={router} />`
  - μ΄ μ»΄ν¬λ„νΈλ¥Ό ν΄λΌμ΄μ–ΈνΈ μ—”νΈλ¦¬μ—μ„ λ λ”λ§ν•λ©΄ μ• ν”λ¦¬μΌ€μ΄μ…μ„ λ λ”λ§ν•κ³  `Router`μ `Wrap` μ»΄ν¬λ„νΈ μµμ…μ„ μλ™μΌλ΅ κµ¬ν„ν•©λ‹λ‹¤.

### Router Creation

λΌμ°ν„°λ” μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈ λ¨λ‘μ—μ„ μ΅΄μ¬ν•λ―€λ΅, λ‘ ν™κ²½μ—μ„ μΌκ΄€λκ² λΌμ°ν„°λ¥Ό μƒμ„±ν•λ” κ²ƒμ΄ μ¤‘μ”ν•©λ‹λ‹¤. μ΄λ¥Ό κ°€μ¥ μ‰½κ² κµ¬ν„ν•λ” λ°©λ²•μ€ μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈ μ—”νΈλ¦¬ νμΌ λ¨λ‘μ—μ„ κ°€μ Έμ™€ νΈμ¶ν•  μ μλ” `createRouter` ν•¨μλ¥Ό κ³µμ  νμΌμ—μ„ λ…Έμ¶ν•λ” κ²ƒμ…λ‹λ‹¤.

- `src/router.tsx`

```tsx
import * as React from "react";
import { createRouter as createTanstackRouter } from "@tanstack/react-router";
import { routeTree } from "./routeTree.gen";

export function createRouter() {
  return createTanstackRouter({ routeTree });
}

declare module "@tanstack/react-router" {
  interface Register {
    router: ReturnType<typeof createRouter>;
  }
}
```

μ΄μ  μ΄ ν•¨μλ¥Ό μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈ μ—”νΈλ¦¬ νμΌμ—μ„ λ¨λ‘ κ°€μ Έμ™€ λΌμ°ν„°λ¥Ό μƒμ„±ν•  μ μμµλ‹λ‹¤.

- `src/entry-server.tsx`

```tsx
import { createRouter } from "./router";

export async function render(req, res) {
  const router = createRouter();
}
```

- `src/entry-client.tsx`

```tsx
import { createRouter } from "./router";

const router = createRouter();
```

### Server History

ν΄λΌμ΄μ–ΈνΈμ—μ„λ” κΈ°λ³Έμ μΌλ΅ `createBrowserHistory` μΈμ¤ν„΄μ¤λ¥Ό μ‚¬μ©ν•μ§€λ§, μ„λ²„μ—μ„λ” λ€μ‹  `createMemoryHistory` μΈμ¤ν„΄μ¤λ¥Ό μ‚¬μ©ν•λ” κ²ƒμ΄ μΆ‹μµλ‹λ‹¤. μ΄λ” `createBrowserHistory`κ°€ `window` κ°μ²΄λ¥Ό μ‚¬μ©ν•κΈ° λ•λ¬ΈμΈλ°, μ„λ²„μ—λ” `window` κ°μ²΄κ°€ μ΅΄μ¬ν•μ§€ μ•κΈ° λ•λ¬Έμ…λ‹λ‹¤.

> π§  μ„λ²„μ—μ„ λ λ”λ§λλ” URLλ΅ λ©”λ¨λ¦¬ νμ¤ν† λ¦¬λ¥Ό μ΄κΈ°ν™”ν•λ” κ²ƒμ„ μμ§€ λ§μ„Έμ”.

- `src/entry-server.tsx`

```tsx
const router = createRouter();

const memoryHistory = createMemoryHistory({
  initialEntries: [opts.url],
});
```

λ©”λ¨λ¦¬ νμ¤ν† λ¦¬ μΈμ¤ν„΄μ¤λ¥Ό μƒμ„±ν• ν›„, μ΄λ¥Ό μ‚¬μ©ν•λ„λ΅ λΌμ°ν„°λ¥Ό μ—…λ°μ΄νΈν•  μ μμµλ‹λ‹¤.

- `src/entry-server.tsx`

```tsx
router.update({
  history: memoryHistory,
});
```

### Loading Critical Router Data on the Server

μ„λ²„μ—μ„ μ• ν”λ¦¬μΌ€μ΄μ…μ„ λ λ”λ§ν•λ ¤λ©΄, λΌμ°ν„°κ°€ ν•΄λ‹Ή κ²½λ΅μ `loader` ν•¨μλ“¤μ„ μ‹¤ν–‰ν•μ—¬ μ¤‘μ”ν• λ°μ΄ν„°λ¥Ό λ΅λ“ν–λ”μ§€ ν™•μΈν•΄μ•Ό ν•©λ‹λ‹¤. μ΄λ¥Ό μ„ν•΄ μ• ν”λ¦¬μΌ€μ΄μ…μ„ λ λ”λ§ν•κΈ° μ „μ— `await router.load()`λ¥Ό νΈμ¶ν•  μ μμµλ‹λ‹¤. μ΄ λ©”μ„λ“λ” μ΄ URLμ— λ€ν•΄ λ§¤μΉ­λ λ¨λ“  κ²½λ΅μ `loader` ν•¨μλ“¤μ΄ λ³‘λ ¬λ΅ μ‹¤ν–‰λ  λ•κΉμ§€ κΈ°λ‹¤λ¦½λ‹λ‹¤.

- `src/entry-server.tsx`

```tsx
await router.load();
```

## Automatic Loader Dehydration/Hydration

λΌμ°ν„°κ°€ κ°€μ Έμ¨ ν•΄κ²°λ λ΅λ” λ°μ΄ν„°λ” μ΄ κ°€μ΄λ“μ—μ„ μ„¤λ…ν• ν‘μ¤€ SSR λ‹¨κ³„λ¥Ό μ™„λ£ν•λ” ν• TanStack Routerμ— μν•΄ μλ™μΌλ΅ λ””ν•μ΄λ“λ μ΄νΈ λ° ν•μ΄λ“λ μ΄νΈλ©λ‹λ‹¤.

β οΈ λ§μ•½ μ§€μ—°λ λ°μ΄ν„° μ¤νΈλ¦¬λ°μ„ μ‚¬μ© μ¤‘μ΄λΌλ©΄, μ΄ κ°€μ΄λ“ λλ¶€λ¶„μ— μλ” [SSR μ¤νΈλ¦¬λ° λ° μ¤νΈλ¦Ό λ³€ν™](#streaming-ssr) ν¨ν„΄μ„ κµ¬ν„ν–λ”μ§€ ν™•μΈν•΄μ•Ό ν•©λ‹λ‹¤.

λ°μ΄ν„° λ΅λ”© λ° λ°μ΄ν„° μ¤νΈλ¦¬λ°μ— λ€ν• λ” μμ„Έν• μ •λ³΄λ” [λ°μ΄ν„° λ΅λ”©](./data-loading.md)κ³Ό [λ°μ΄ν„° μ¤νΈλ¦¬λ°](../data-streaming) κ°€μ΄λ“λ¥Ό μ°Έμ΅°ν•μ„Έμ”.

### Rendering the Application on the Server

ν„μ¬ URLμ— λ€ν•΄ μ¤‘μ”ν• λ°μ΄ν„°λ¥Ό λ¨λ‘ λ΅λ“ν• λΌμ°ν„° μΈμ¤ν„΄μ¤λ¥Ό κ°€μ§€κ³  λ‚λ©΄, μ„λ²„μ—μ„ μ• ν”λ¦¬μΌ€μ΄μ…μ„ λ λ”λ§ν•  μ μμµλ‹λ‹¤:

```tsx
// src/entry-server.tsx

const html = ReactDOMServer.renderToString(<StartServer router={router} />);
```

### Handling Not Found Errors

`router`μ—λ” λ λ”λ§ μ¤‘μ— μ°Ύμ„ μ μ—†λ” μ¤λ¥κ°€ λ°μƒν–λ”μ§€ ν™•μΈν•λ” `hasNotFoundMatch` λ©”μ„λ“κ°€ μμµλ‹λ‹¤. μ΄ λ©”μ„λ“λ¥Ό μ‚¬μ©ν•μ—¬ μ°Ύμ„ μ μ—†λ” μ¤λ¥κ°€ λ°μƒν–λ”μ§€ ν™•μΈν•κ³  μ‘λ‹µ μƒνƒ μ½”λ“λ¥Ό μ μ ν μ„¤μ •ν•  μ μμµλ‹λ‹¤:

```tsx
// src/entry-server.tsx
if (router.hasNotFoundMatch()) statusCode = 404;
```

### All Together Now!

μ„μ—μ„ λ…Όμλ λ¨λ“  κ°λ…μ„ μ‚¬μ©ν• μ„λ²„ μ—”νΈλ¦¬ νμΌμ μ „μ²΄ μμ‹μ…λ‹λ‹¤.

```tsx
// src/entry-server.tsx
import * as React from "react";
import ReactDOMServer from "react-dom/server";
import { createMemoryHistory } from "@tanstack/react-router";
import { StartServer } from "@tanstack/start/server";
import { createRouter } from "./router";

export async function render(url, response) {
  const router = createRouter();

  const memoryHistory = createMemoryHistory({
    initialEntries: [url],
  });

  router.update({
    history: memoryHistory,
  });

  await router.load();

  const appHtml = ReactDOMServer.renderToString(
    <StartServer router={router} />
  );

  response.statusCode = router.hasNotFoundMatch() ? 404 : 200;
  response.setHeader("Content-Type", "text/html");
  response.end(`<!DOCTYPE html>${appHtml}`);
}
```

## Rendering the Application on the Client

ν΄λΌμ΄μ–ΈνΈμ—μ„λ” μ‘μ—…μ΄ ν›¨μ”¬ κ°„λ‹¨ν•©λ‹λ‹¤.

- λΌμ°ν„° μΈμ¤ν„΄μ¤λ¥Ό μƒμ„±
- `<StartClient />` μ»΄ν¬λ„νΈλ¥Ό μ‚¬μ©ν•μ—¬ μ• ν”λ¦¬μΌ€μ΄μ…μ„ λ λ”λ§

```tsx
// src/entry-client.tsx

import * as React from "react";
import ReactDOM from "react-dom/client";

import { StartClient } from "@tanstack/start";
import { createRouter } from "./router";

const router = createRouter();

ReactDOM.hydrateRoot(document, <StartClient router={router} />);
```

μ΄ μ„¤μ •μΌλ΅ μ• ν”λ¦¬μΌ€μ΄μ…μ€ μ„λ²„μ—μ„ λ λ”λ§λκ³  ν΄λΌμ΄μ–ΈνΈμ—μ„ ν•μ΄λ“λ μ΄νΈλ©λ‹λ‹¤!

## Streaming SSR

μ¤νΈλ¦¬λ° SSRμ€ κ°€μ¥ ν„λ€μ μΈ SSR μ ν•μΌλ΅, μ„λ²„μ—μ„ λ λ”λ§λλ” λ€λ΅ HTML λ§ν¬μ—…μ„ ν΄λΌμ΄μ–ΈνΈλ΅ μ§€μ†μ μΌλ΅ κ·Έλ¦¬κ³  μ μ§„μ μΌλ΅ μ „μ†΅ν•λ” κ³Όμ •μ…λ‹λ‹¤. μ΄λ” μ „ν†µμ μΈ SSRκ³Όλ” κ°λ…μ μΌλ΅ μ•½κ°„ λ‹¤λ¦…λ‹λ‹¤. μ™λƒν•λ©΄ μ¤‘μ”ν• μ²« λ²μ§Έ νμΈνΈλ¥Ό ν•μ΄λ“λ μ΄νΈν•κ³  λ§ν¬μ—…κ³Ό λ°μ΄ν„°λ” λ™μΌν• μ”μ²­μ—μ„ λ λ”λ§ ν›„ ν΄λΌμ΄μ–ΈνΈλ΅ μ¤νΈλ¦¬λ°λ  μ μκΈ° λ•λ¬Έμ…λ‹λ‹¤.

μ΄ ν¨ν„΄μ€ λ°μ΄ν„° νμΉ­ μ”κµ¬κ°€ λλ¦¬κ±°λ‚ κ³ μ§€μ—°μΈ νμ΄μ§€μ— μ μ©ν•  μ μμµλ‹λ‹¤. μλ¥Ό λ“¤μ–΄, νƒ€μ‚¬ APIμ—μ„ λ°μ΄ν„°λ¥Ό κ°€μ Έμ™€μ•Ό ν•λ” νμ΄μ§€κ°€ μλ‹¤λ©΄, μ¤‘μ”ν• μ΄κΈ° λ§ν¬μ—…κ³Ό λ°μ΄ν„°λ¥Ό ν΄λΌμ΄μ–ΈνΈλ΅ μ¤νΈλ¦¬λ°ν•κ³  κ·Έ ν›„ νƒ€μ‚¬ λ°μ΄ν„°λ¥Ό μ¤νΈλ¦¬λ°ν•  μ μμµλ‹λ‹¤.

**μ΄ μ¤νΈλ¦¬λ° ν¨ν„΄μ€ `renderToPipeableStream`μ„ μ‚¬μ©ν•λ” ν• μλ™μΌλ΅ μ²λ¦¬λ©λ‹λ‹¤.**

## Streaming Dehydration/Hydration

μ¤νΈλ¦¬λ° λ””ν•μ΄λ“λ μ΄νΈ/ν•μ΄λ“λ μ΄νΈλ” λ§ν¬μ—…μ„ λ„μ–΄μ„λ” κ³ κΈ‰ ν¨ν„΄μΌλ΅, μ„λ²„μ—μ„ ν΄λΌμ΄μ–ΈνΈλ΅ μ§€μ› λ°μ΄ν„°λ¥Ό λ””ν•μ΄λ“λ μ΄νΈν•κ³  μ¤νΈλ¦¬λ°ν•λ©°, μ΄λ¥Ό λ„μ°© μ‹ ν•μ΄λ“λ μ΄νΈν•λ” κ³Όμ •μ…λ‹λ‹¤. μ΄λ” μ΄κΈ° λ§ν¬μ—…μ„ λ λ”λ§ν•λ” λ° μ‚¬μ©λ κΈ°λ³Έ λ°μ΄ν„°λ¥Ό μ¶”κ°€μ μΌλ΅ μ‚¬μ©/κ΄€λ¦¬ν•  ν•„μ”κ°€ μλ” μ• ν”λ¦¬μΌ€μ΄μ…μ— μ μ©ν•©λ‹λ‹¤.

## Data Transformers

SSRμ„ μ‚¬μ©ν•  λ•, μ„λ²„μ™€ ν΄λΌμ΄μ–ΈνΈ κ°„μ— λ°μ΄ν„°λ¥Ό μ „μ†΅ν•λ ¤λ©΄ λ°μ΄ν„°κ°€ μ§λ ¬ν™”λμ–΄μ•Ό ν•©λ‹λ‹¤. κΈ°λ³Έμ μΌλ΅ TanStack Routerλ” `JSON.stringify/JSON.parse` μ™Έμ—λ„ λ‡ κ°€μ§€ κΈ°λ³Έ μ ν•μ„ μ§€μ›ν•λ” λ§¤μ° κ°€λ²Όμ΄ μ§λ ¬ν™”κΈ°λ¥Ό μ‚¬μ©ν•μ—¬ λ°μ΄ν„°λ¥Ό μ§λ ¬ν™”ν•©λ‹λ‹¤.

κΈ°λ³Έμ μΌλ΅ μ§€μ›λλ” μ ν•μ€ λ‹¤μκ³Ό κ°™μµλ‹λ‹¤:

- `Date`
- `undefined`

κΈ°λ³Έμ μΌλ΅ μ§€μ›λμ–΄μ•Ό ν•λ” λ‹¤λ¥Έ μ ν•μ΄ μλ‹¤κ³  μƒκ°λλ©΄, TanStack Router λ ν¬μ§€ν† λ¦¬μ—μ„ μ΄μλ¥Ό μ—΄μ–΄μ£Όμ„Έμ”.

`Map`, `Set`, `BigInt` λ“±μ λ³µμ΅ν• λ°μ΄ν„° μ ν•μ„ μ‚¬μ©ν•λ” κ²½μ°, λ°μ΄ν„°μ μ •ν™•ν• νƒ€μ… μ •μμ™€ μ§λ ¬ν™”/μ—­μ§λ ¬ν™”κ°€ μ λ€λ΅ μ΄λ£¨μ–΄μ§€λ„λ΅ ν•κΈ° μ„ν•΄ μ‚¬μ©μ μ •μ μ§λ ¬ν™”κΈ°λ¥Ό μ‚¬μ©ν•΄μ•Ό ν•  μ μμµλ‹λ‹¤. μ΄λ• `createRouter`μ `transformer` μµμ…μ„ μ‚¬μ©ν•λ©΄ λ©λ‹λ‹¤.

λ°μ΄ν„° λ³€ν™κΈ° APIλ” λ„¤νΈμ›ν¬λ¥Ό ν†µν• ν†µμ‹  μ‹ μ΄λ¬ν• λ°μ΄ν„° μ ν•μ„ ν¬λ…ν•κ² μ‚¬μ©ν•  μ μλ„λ΅ μ‚¬μ©μ μ •μ μ§λ ¬ν™”κΈ°λ¥Ό μ‚¬μ©ν•  μ μκ² ν•΄μ¤λ‹λ‹¤.

λ‹¤μ μμ‹λ” [SuperJSON](https://github.com/blitz-js/superjson)μ„ μ‚¬μ©ν•λ” μμ‹λ¥Ό λ³΄μ—¬μ¤λ‹λ‹¤. κ·Έλ¬λ‚ [`Router Transformer`](../api/router/RouterOptionsType.md#transformer-property)λ¥Ό κµ¬ν„ν• λ‹¤λ¥Έ λΌμ΄λΈλ¬λ¦¬λ„ μ‚¬μ©ν•  μ μμµλ‹λ‹¤.

```tsx
import { SuperJSON } from "superjson";

const router = createRouter({
  transformer: SuperJSON,
});
```

μ΄λ ‡κ² ν•λ©΄ TanStack Routerλ” μ΄μ  λ„¤νΈμ›ν¬λ¥Ό ν†µν•΄ λ°μ΄ν„°λ¥Ό μ§λ ¬ν™”ν•  λ• SuperJSONμ„ μ μ ν μ‚¬μ©ν•©λ‹λ‹¤.
