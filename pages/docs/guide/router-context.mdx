---
title: Router Context
---

## Router Context

TanStack Routerì˜ ë¼ìš°í„° ì»¨í…ìŠ¤íŠ¸ëŠ” ì˜ì¡´ì„± ì£¼ì…ì„ í¬í•¨í•œ ë‹¤ì–‘í•œ ì‘ì—…ì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë§¤ìš° ê°•ë ¥í•œ ë„êµ¬ì…ë‹ˆë‹¤. ì´ë¦„ ê·¸ëŒ€ë¡œ, ë¼ìš°í„° ì»¨í…ìŠ¤íŠ¸ëŠ” ë¼ìš°í„°ë¥¼ í†µí•´ ì „ë‹¬ë˜ê³  ê° ë§¤ì¹­ëœ ë¼ìš°íŠ¸ë¥¼ í†µí•´ ë‚´ë ¤ê°‘ë‹ˆë‹¤. ê³„ì¸µ êµ¬ì¡°ì˜ ê° ë¼ìš°íŠ¸ì—ì„œ ì»¨í…ìŠ¤íŠ¸ë¥¼ ìˆ˜ì •í•˜ê±°ë‚˜ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ìŒì€ ë¼ìš°í„° ì»¨í…ìŠ¤íŠ¸ë¥¼ ì‹¤ì§ˆì ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ëª‡ ê°€ì§€ ë°©ë²•ì…ë‹ˆë‹¤:

- ì˜ì¡´ì„± ì£¼ì…
  - ë¡œë” í•¨ìˆ˜, ë°ì´í„° í˜ì¹­ í´ë¼ì´ì–¸íŠ¸, ë³€í™˜ ì„œë¹„ìŠ¤ ë“± ë¼ìš°íŠ¸ì™€ ëª¨ë“  í•˜ìœ„ ë¼ìš°íŠ¸ì—ì„œ ì§ì ‘ ê°€ì ¸ì˜¤ê±°ë‚˜ ìƒì„±í•˜ì§€ ì•Šê³  ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì˜ì¡´ì„±ì„ ì œê³µí•©ë‹ˆë‹¤.
- íƒìƒ‰ ê²½ë¡œ
  - ê° ë¼ìš°íŠ¸ì˜ ê³ ìœ í•œ ì»¨í…ìŠ¤íŠ¸ê°€ ì €ì¥ë˜ë¯€ë¡œ, ê° ë¼ìš°íŠ¸ì˜ ì»¨í…ìŠ¤íŠ¸ì— íƒìƒ‰ ê²½ë¡œë‚˜ ë©”ì„œë“œë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ë™ì  ë©”íƒ€ íƒœê·¸ ê´€ë¦¬
  - ê° ë¼ìš°íŠ¸ì˜ ì»¨í…ìŠ¤íŠ¸ì— ë©”íƒ€ íƒœê·¸ë¥¼ ì¶”ê°€í•˜ê³ , ë©”íƒ€ íƒœê·¸ ê´€ë¦¬ìë¥¼ ì‚¬ìš©í•˜ì—¬ ì‚¬ìš©ìê°€ ì‚¬ì´íŠ¸ë¥¼ íƒìƒ‰í•  ë•Œ ë©”íƒ€ íƒœê·¸ë¥¼ ë™ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ì™¸ì—ë„ ë¼ìš°í„° ì»¨í…ìŠ¤íŠ¸ëŠ” ì›í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!

## Typed Router Context

ë£¨íŠ¸ ë¼ìš°í„° ì»¨í…ìŠ¤íŠ¸ëŠ” ì—„ê²©í•˜ê²Œ íƒ€ì…ì´ ì§€ì •ë©ë‹ˆë‹¤. ì´ íƒ€ì…ì€ ë¼ìš°íŠ¸ ë§¤ì¹˜ íŠ¸ë¦¬ì—ì„œ `beforeLoad` ì˜µì…˜ì„ í†µí•´ í™•ì¥ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë£¨íŠ¸ ë¼ìš°í„° ì»¨í…ìŠ¤íŠ¸ì˜ íƒ€ì…ì„ ì œí•œí•˜ë ¤ë©´ `createRootRoute()` ëŒ€ì‹  `createRootRouteWithContext<YourContextTypeHere>()(routeOptions)` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”. ì˜ˆ:

```tsx
import {
  createRootRouteWithContext,
  createRouter,
} from "@tanstack/react-router";

interface MyRouterContext {
  user: User;
}

// Router Contextë¥¼ ì‚¬ìš©í•˜ì—¬ ë£¨íŠ¸ ë¼ìš°íŠ¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
const rootRoute = createRootRouteWithContext<MyRouterContext>()({
  component: App,
});

const routeTree = rootRoute.addChildren([
  // ...
]);

// Router Contextë¥¼ ì‚¬ìš©í•˜ì—¬ ë¼ìš°í„°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
const router = createRouter({
  routeTree,
});
```

## Passing the initial Router Context

Router ContextëŠ” ë¼ìš°í„° ì´ˆê¸°í™” ì‹œ ì „ë‹¬ë©ë‹ˆë‹¤. ì´ˆê¸° Router ContextëŠ” `context` ì˜µì…˜ì„ í†µí•´ ë¼ìš°í„°ì— ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> [!TIP]
> Contextì— í•„ìš”í•œ ì†ì„±ì´ ìˆë‹¤ë©´, ì´ˆê¸° Router Contextì— ì´ë¥¼ ì „ë‹¬í•˜ì§€ ì•Šìœ¼ë©´ TypeScript ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤. ëª¨ë“  Context ì†ì„±ì´ ì„ íƒ ì‚¬í•­ì¸ ê²½ìš°, TypeScript ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì§€ ì•Šìœ¼ë©° Contextë¥¼ ì „ë‹¬í•˜ëŠ” ê²ƒì€ ì„ íƒ ì‚¬í•­ì´ ë©ë‹ˆë‹¤. Contextë¥¼ ì „ë‹¬í•˜ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ê°’ìœ¼ë¡œ `{}`ê°€ ì‚¬ìš©ë©ë‹ˆë‹¤.

```tsx
import { createRouter } from "@tanstack/react-router";

// Router Contextë¥¼ ì‚¬ìš©í•˜ì—¬ ë¼ìš°í„°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
const router = createRouter({
  routeTree,
  context: {
    user: {
      id: "123",
      name: "John Doe",
    },
  },
});
```

### Invalidating the Router Context

Routerì— ì „ë‹¬ëœ Context ìƒíƒœë¥¼ ë¬´íš¨í™”í•´ì•¼ í•˜ëŠ” ê²½ìš°, `invalidate` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ë¼ìš°í„°ê°€ Contextë¥¼ ë‹¤ì‹œ ê³„ì‚°í•˜ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŠ” Context ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ê³  ë¼ìš°í„°ê°€ ëª¨ë“  ë¼ìš°íŠ¸ì— ëŒ€í•´ Contextë¥¼ ë‹¤ì‹œ ê³„ì‚°í•˜ë„ë¡ í•´ì•¼ í•  ë•Œ ìœ ìš©í•©ë‹ˆë‹¤.

```tsx
function useAuth() {
  const router = useRouter();
  const [user, setUser] = useState<User | null>(null);

  useEffect(() => {
    const unsubscribe = auth.onAuthStateChanged((user) => {
      setUser(user);
      router.invalidate();
    });

    return unsubscribe;
  }, []);

  return user;
}
```

## Using the Router Context

Router Context íƒ€ì…ì„ ì •ì˜í•œ í›„, ì´ë¥¼ ë¼ìš°íŠ¸ ì •ì˜ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```tsx
// src/routes/todos.tsx
export const Route = createFileRoute("/todos")({
  component: Todos,
  loader: ({ context }) => fetchTodosByUserId(context.user.id),
});
```

ë°ì´í„° í˜ì¹­ ë° ë³€í™˜ êµ¬í˜„ ìì²´ë¥¼ ì£¼ì…í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤! ì´ëŠ” ê°•ë ¥íˆ ê¶Œì¥ë©ë‹ˆë‹¤ ğŸ˜œ

ê°„ë‹¨í•œ í•¨ìˆ˜ë¡œ TODOë¥¼ í˜ì¹­í•˜ëŠ” ì˜ˆì œë¥¼ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤:

```tsx
const fetchTodosByUserId = async ({ userId }) => {
  const response = await fetch(`/api/todos?userId=${userId}`);
  const data = await response.json();
  return data;
};

const router = createRouter({
  routeTree: rootRoute,
  context: {
    userId: "123",
    fetchTodosByUserId,
  },
});
```

ê·¸ëŸ° ë‹¤ìŒ ë¼ìš°íŠ¸ì—ì„œ:

```tsx
// src/routes/todos.tsx
export const Route = createFileRoute("/todos")({
  component: Todos,
  loader: ({ context }) => context.fetchTodosByUserId(context.userId),
});
```

### How about an external data fetching library?

```tsx
import {
  createRootRouteWithContext,
  createRouter,
} from "@tanstack/react-router";

interface MyRouterContext {
  queryClient: QueryClient;
}

const rootRoute = createRootRouteWithContext<MyRouterContext>()({
  component: App,
});

const queryClient = new QueryClient();

const router = createRouter({
  routeTree: rootRoute,
  context: {
    queryClient,
  },
});
```

ê·¸ëŸ° ë‹¤ìŒ ë¼ìš°íŠ¸ì—ì„œ:

```tsx
// src/routes/todos.tsx
export const Route = createFileRoute("/todos")({
  component: Todos,
  loader: async ({ context }) => {
    await context.queryClient.ensureQueryData({
      queryKey: ["todos", { userId: user.id }],
      queryFn: fetchTodos,
    });
  },
});
```

## How about using React Context/Hooks?

ë¼ìš°íŠ¸ì˜ `beforeLoad` ë˜ëŠ” `loader` í•¨ìˆ˜ì—ì„œ React Context ë˜ëŠ” Hooksë¥¼ ì‚¬ìš©í•˜ë ¤ê³  í•  ë•Œ Reactì˜ [Hooks ê·œì¹™](https://react.dev/reference/rules/rules-of-hooks)ì„ ê¸°ì–µí•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ë¹„-React í•¨ìˆ˜ì—ì„œëŠ” Hooksë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ, `beforeLoad` ë˜ëŠ” `loader` í•¨ìˆ˜ì—ì„œëŠ” Hooksë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.

ê·¸ë ‡ë‹¤ë©´ `beforeLoad` ë˜ëŠ” `loader` í•¨ìˆ˜ì—ì„œ React Contextë‚˜ Hooksë¥¼ ì–´ë–»ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆì„ê¹Œìš”? ì´ë¥¼ ìœ„í•´ Router Contextë¥¼ í™œìš©í•˜ì—¬ React Contextë‚˜ Hooksë¥¼ ë¼ìš°íŠ¸ì˜ `beforeLoad` ë˜ëŠ” `loader` í•¨ìˆ˜ë¡œ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë‹¤ìŒì€ `useNetworkStrength` í›…ì„ ë¼ìš°íŠ¸ì˜ `loader` í•¨ìˆ˜ë¡œ ì „ë‹¬í•˜ëŠ” ì˜ˆì œë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤:

- `src/routes/__root.tsx`

```tsx
// ë¨¼ì € ë£¨íŠ¸ ë¼ìš°íŠ¸ì˜ ì»¨í…ìŠ¤íŠ¸ê°€ íƒ€ì…í™”ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
import { createRootRouteWithContext } from "@tanstack/react-router";
import { useNetworkStrength } from "@/hooks/useNetworkStrength";

interface MyRouterContext {
  networkStrength: ReturnType<typeof useNetworkStrength>;
}

export const Route = createRootRouteWithContext<MyRouterContext>()({
  component: App,
});
```

ì´ ì˜ˆì œì—ì„œëŠ” `<RouterProvider />`ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¼ìš°í„°ë¥¼ ë Œë”ë§í•˜ê¸° ì „ì— í›…ì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë©´ React ë‚´ì—ì„œ í›…ì´ í˜¸ì¶œë˜ì–´ Hooks ê·œì¹™ì„ ì¤€ìˆ˜í•˜ê²Œ ë©ë‹ˆë‹¤.

- `src/router.tsx`

```tsx
import { createRouter } from "@tanstack/react-router";

import { routeTree } from "./routeTree.gen";

export const router = createRouter({
  routeTree,
  context: {
    networkStrength: undefined!, // Reactì—ì„œ ì„¤ì •í•©ë‹ˆë‹¤.
  },
});
```

- `src/main.tsx`

```tsx
import { RouterProvider } from "@tanstack/react-router";
import { router } from "./router";

import { useNetworkStrength } from "@/hooks/useNetworkStrength";

function App() {
  const networkStrength = useNetworkStrength();
  // í›…ì—ì„œ ë°˜í™˜ëœ ê°’ì„ Router Contextì— ì£¼ì…í•©ë‹ˆë‹¤.
  return <RouterProvider router={router} context={{ networkStrength }} />;
}

// ...
```

ì´ì œ ë¼ìš°íŠ¸ì˜ `loader` í•¨ìˆ˜ì—ì„œ Router Contextì—ì„œ `networkStrength` í›…ì„ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

- `src/routes/posts.tsx`

```tsx
import { createFileRoute } from "@tanstack/react-router";

export const Route = createFileRoute("/posts")({
  component: Posts,
  loader: ({ context }) => {
    if (context.networkStrength === "STRONG") {
      // ì‘ì—… ìˆ˜í–‰
    }
  },
});
```

## Modifying the Router Context

Router ContextëŠ” ë¼ìš°íŠ¸ íŠ¸ë¦¬ë¥¼ ë”°ë¼ ë‚´ë ¤ê°€ë©° ì „ë‹¬ë˜ë©° ê° ë¼ìš°íŠ¸ì—ì„œ ë³‘í•©ë©ë‹ˆë‹¤. ë”°ë¼ì„œ ê° ë¼ìš°íŠ¸ì—ì„œ ì»¨í…ìŠ¤íŠ¸ë¥¼ ìˆ˜ì •í•  ìˆ˜ ìˆìœ¼ë©°, ìˆ˜ì • ì‚¬í•­ì€ ëª¨ë“  í•˜ìœ„ ë¼ìš°íŠ¸ì— ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆ:

- `src/routes/__root.tsx`

```tsx
import { createRootRouteWithContext } from "@tanstack/react-router";

interface MyRouterContext {
  foo: boolean;
}

export const Route = createRootRouteWithContext<MyRouterContext>()({
  component: App,
});
```

- `src/router.tsx`

```tsx
import { createRouter } from "@tanstack/react-router";

import { routeTree } from "./routeTree.gen";

const router = createRouter({
  routeTree,
  context: {
    foo: true,
  },
});
```

- `src/routes/todos.tsx`

```tsx
import { createFileRoute } from "@tanstack/react-router";

export const Route = createFileRoute("/todos")({
  component: Todos,
  beforeLoad: () => {
    return {
      bar: true,
    };
  },
  loader: ({ context }) => {
    context.foo; // true
    context.bar; // true
  },
});
```

## Processing Accumulated Route Context

íŠ¹íˆ ê°œë³„ ë¼ìš°íŠ¸ì˜ `context` ê°ì²´ëŠ” ëª¨ë“  ë§¤ì¹­ëœ ë¼ìš°íŠ¸ì— ëŒ€í•œ ì»¨í…ìŠ¤íŠ¸ ê°ì²´ë¥¼ ì‰½ê²Œ ì¶•ì í•˜ê³  ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ ë§Œë“­ë‹ˆë‹¤. ë‹¤ìŒì€ ëª¨ë“  ë§¤ì¹­ëœ ë¼ìš°íŠ¸ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ íƒìƒ‰ ê²½ë¡œë¥¼ ìƒì„±í•˜ëŠ” ì˜ˆì œì…ë‹ˆë‹¤:

```tsx
// src/routes/__root.tsx
export const Route = createRootRoute({
  component: () => {
    const matches = useRouterState({ select: (s) => s.matches });

    const breadcrumbs = matches
      .filter((match) => match.context.getTitle)
      .map(({ pathname, context }) => {
        return {
          title: context.getTitle(),
          path: pathname,
        };
      });

    // ...
  },
});
```

ë™ì¼í•œ ë¼ìš°íŠ¸ ì»¨í…ìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ í˜ì´ì§€ `<head>`ì˜ ì œëª© íƒœê·¸ë¥¼ ìƒì„±í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤:

```tsx
// src/routes/__root.tsx
export const Route = createRootRoute({
  component: () => {
    const matches = useRouterState({ select: (s) => s.matches });

    const matchWithTitle = [...matches]
      .reverse()
      .find((d) => d.context.getTitle);

    const title = matchWithTitle?.context.getTitle() || "My App";

    return (
      <html>
        <head>
          <title>{title}</title>
        </head>
        <body>{/* ... */}</body>
      </html>
    );
  },
});
```
